<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>General Health Assesment</title>
    <link rel="icon" href="./img/uaeu-favicon2.ico" type="image/x-icon" />
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.11.2/css/all.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.17/dist/sweetalert2.min.css"
      integrity="sha256-qpXwccFYncH5gTqXFe9EXZ8QeDw1Re68bbNVfFZzIzg="
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="./css/mdb.min.css" />
    <!-- <link rel="stylesheet" href="./css/compiled.min.css" /> -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.css"
      integrity="sha512-2eMmukTZtvwlfQoG8ztapwAH5fXaQBzaMqdljLopRSA0i6YKM8kBAOrSSykxu9NN9HrtD45lIqfONLII2AFL/Q=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    />
    <link rel="stylesheet" href="./css/style.css" />
    <!-- Custom styles -->
    <style></style>
    <script
      src="https://code.jquery.com/jquery-3.6.0.min.js"
      integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
      crossorigin="anonymous"
    ></script>
    <script>
      $(function () {
        $("#header").load("./header.html");
        $("#footer").load("./footer.html");
      });
    </script>
  </head>
  <body>
    <header id="header"></header>
    <main>
      <div class="container vh-100 pt-5">
        <form id="register" autocomplete="off">
          <div class="row">
            <div class="col col-sm-12 col-md-6">
              <div class="h-100 d-flex flex-column align-items-center">
                <div class="align-self-center mb-5">
                  <img
                    id="logo"
                    class="img-fluid"
                    src="./img/uaeu-logo.png"
                    alt="United Arab Emirates University Logo"
                  />
                </div>
                <div class="mb-3 text-black">
                  <!-- Email input -->
                  <div class="form-outline mb-4">
                    <input type="email" id="email" class="form-control" name="email" required />
                    <label class="form-label" for="email">Email address</label>
                  </div>
                  <!-- Full Name input -->
                  <div class="form-outline mb-4">
                    <input type="text" id="full_name" class="form-control" name="full_name" required />
                    <label class="form-label" for="full_name">Full Name</label>
                  </div>
                  <!--GENDER-->
                  <div class="mb-4">
                    <select class="form-control" name="gender" required>
                      <option value="" disabled selected>Gender</option>
                      <option value="male">Male</option>
                      <option value="female">Female</option>
                    </select>
                  </div>
                  <!--Emirates -->
                  <div class="mb-4">
                    <select class="form-control" name="emirates" id="emirates" required>
                      <option value="" disabled selected>Emirates</option>
                      <option value="Abu Dhabi">Abu Dhabi</option>
                      <option value="Ajman">Ajman</option>
                      <option value="Dubai">Dubai</option>
                      <option value="Fujairah">Fujairah</option>
                      <option value="Ras Al Khaimah">Ras Al Khaimah</option>
                      <option value="Sharjah">Sharjah</option>
                      <option value="Umm Al Quwain">Umm Al Quwain</option>
                    </select>
                  </div>
                  <!-- DOB-->
                  <div class="form-outline mb-4">
                    <input
                      type="text"
                      id="birthdate"
                      class="form-control"
                      name="birthdate"
                      onfocus="(this.type='date')"
                      onfocusout="(this.type='text')"
                    />
                    <label class="form-label" for="birthdate">Date of Birth</label>
                  </div>
                  <!-- Phone Number-->
                  <div class="form-outline mb-4">
                    <input type="text" id="phone_number" class="form-control" name="phone_number" required />
                    <label class="form-label" for="phone_number">Phone Number</label>
                  </div>
                  <div class="error-msg text-danger text-center border border-danger p-2 d-none">Error Message...</div>
                </div>
              </div>
            </div>
            <div class="col col-sm-12 col-md-6">
              <!--Emirates ID Front -->
              <div class="file-upload-wrapper mb-3">
                <input
                  id="emirates_id_front"
                  type="file"
                  name="emirates_id_front"
                  class="file-upload-input"
                  data-file-upload="file-upload"
                  data-default-file="./img/eidf.jpg"
                  data-default-msg="UPLOAD - EMIRATES ID FRONT"
                  data-height="200"
                  data-max-file-size="1M"
                  data-accepted-extensions="image/*"
                  accept="image/*"
                />
              </div>
              <!--Emirates ID Back -->
              <div class="file-upload-wrapper">
                <input
                  id="emirates_id_back"
                  type="file"
                  name="emirates_id_back"
                  class="file-upload-input"
                  data-file-upload="file-upload"
                  data-default-file="./img/eidb.jpg"
                  data-default-msg="UPLOAD - EMIRATES ID BACK"
                  data-height="200"
                  data-max-file-size="1M"
                  data-accepted-extensions="image/*"
                  accept="image/*"
                />
              </div>
            </div>
            <div class="col-sm-12 col-md-6 text-center">
              <!-- Submit button -->
              <button type="submit" class="btn btn-primary my-3">START</button>
            </div>
          </div>
        </form>
      </div>
    </main>
    <footer id="footer"></footer>
  </body>
  <script type="text/javascript" src="./js/mdb.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/form2js@1.0.0/src/form2js.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/croppie/2.6.5/croppie.min.js"
    integrity="sha512-Gs+PsXsGkmr+15rqObPJbenQ2wB3qYvTHuJO6YJzPe/dTLvhy0fmae2BcnaozxDo5iaF8emzmCZWbQ1XXiX2Ig=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
  <!-- Custom scripts -->

  <script src="./js/scripts.js"></script>
  <script type="text/javascript">
    $("#register").on("submit", function (e) {
      e.preventDefault();

      let formData = form2js("register", ".", true, null);
      sessionStorage.setItem("user", JSON.stringify(formData));

      console.log("form data - ", formData);
      asyncResponse("POST", "/users", formData, (res) => {
        if (res.statusCode != 200 || res.hasOwnProperty("message")) {
          $(".error-msg").removeClass("d-none").html(res.message);
          return;
        }

        if (res.hasOwnProperty("emirates_id_front")) {
          uploadFiles("emirates_id_front", res.emirates_id_front);
        }

        if (res.hasOwnProperty("emirates_id_back")) {
          uploadFiles("emirates_id_back", res.emirates_id_back);
        }

        // $("#register").trigger("reset");
        setTimeout(() => {
          window.location = "./language.html";
        }, 3000);
      });
    });

    function uploadFiles(inputId, link) {
      let file = document.getElementById(inputId).files[0];
      $.ajax({
        url: link,
        type: "PUT",
        data: file,
        // contentType: "image/jpeg",
        processData: false,
        // cache: false,
        error: function (error) {
          console.error("error", error);
          // dangerToast("Error While Upload Images");
        },
        success: function (res) {
          console.log("success -", res);
        },
      });
    }
  </script>
</html>
